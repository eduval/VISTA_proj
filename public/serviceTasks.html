<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="UTF-8">
  <title>VISTA</title>
  <meta name="description" content="Faith Media Volunteer Management System">

  <meta name="viewport" content="width=device-width, maximum-scale=5, initial-scale=1">

  <!-- up to 10% speed up for external res -->
  <link rel="dns-prefetch" href="https://fonts.googleapis.com/">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com/">
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/">
  <!-- preloading icon font is helping to speed up a little bit -->
  <link rel="preload" href="assets/fonts/flaticon/Flaticon.woff2" as="font" type="font/woff2" crossorigin>

  <link rel="stylesheet" href="assets/css/core.min.css">
  <link rel="stylesheet" href="assets/css/vendor_bundle.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap">

  <!-- favicon -->
  <link rel="shortcut icon" href="favicon.png">

</head>


<!--

    Layout Admin
      .layout-admin   (required)

      .aside-sticky           - sidebar : fixed and push header
      .header-sticky          - header : always visible on top (acting as old .header-focus)

    ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++

    SCROLL TO TOP BUTTON [optional styling]

      data-s2t-disable="true"
      data-s2t-position="start|end"
      data-s2t-class="btn-secondary btn-sm"   (default)
      data-s2t-class="btn-secondary rounded-circle"
      data-s2t-class="btn-warning rounded-circle"

    ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++ ++

  -->

<body class="layout-admin aside-sticky bg-lime header-sticky"
  data-s2t-class="btn-primary btn-sm bg-gradient-default rounded-circle border-0">

  <div id="wrapper" class="d-flex align-items-stretch flex-column">

    <!-- ================= HEADER ================= -->
    <header id="header" class="d-flex align-items-center shadow-xs">
      <div class="container-fluid position-relative">

        <nav class="navbar navbar-expand-lg navbar-light justify-content-between">

          <!-- LEFT -->
          <div class="align-items-start d-flex">
            <!-- sidebar toggler --> <a href="#aside-main"
              class="btn-sidebar-toggle h-100 d-inline-block d-lg-none justify-content-center align-items-center p-2">
              <span> <svg width="25" height="25" viewBox="0 0 20 20">
                  <path d="M 19.9876 1.998 L -0.0108 1.998 L -0.0108 -0.0019 L 19.9876 -0.0019 L 19.9876 1.998 Z">
                  </path>
                  <path d="M 19.9876 7.9979 L -0.0108 7.9979 L -0.0108 5.9979 L 19.9876 5.9979 L 19.9876 7.9979 Z">
                  </path>
                  <path d="M 19.9876 13.9977 L -0.0108 13.9977 L -0.0108 11.9978 L 19.9876 11.9978 L 19.9876 13.9977 Z">
                  </path>
                  <path d="M 19.9876 19.9976 L -0.0108 19.9976 L -0.0108 17.9976 L 19.9876 17.9976 L 19.9876 19.9976 Z">
                  </path>
                </svg> </span> </a>

            <a class="navbar-brand d-lg-none mx-2" href="admindashboard.html">
              <img src="favicon.png" width="38" height="38" alt="VISTA">
            </a>
          </div>

          <!-- CENTER (COLLAPSIBLE) -->
          <div class="collapse navbar-collapse" id="navbarMainNav">
            <h1 class="h4 mb-0 text-dark px-4 fw-normal">
              My Services
              <span class="d-block mt-2 text-muted smaller">
                <nav aria-label="breadcrumb">
                  <ol class="breadcrumb small mb-1">
                    <li class="breadcrumb-item"><a href="admindashboard.html">Home</a></li>
                    <li class="breadcrumb-item text-muted active">New Service</li>
                  </ol>
                </nav>
                <span id="serviceDate" class="d-block mt-1 text-muted"></span>
              </span>
            </h1>
          </div>

          <!-- ✅ RIGHT STATUS (ALWAYS VISIBLE) -->
          <div class="d-flex align-items-center ms-auto me-2">
            <div id="serviceStatusContainer" class="d-flex align-items-center gap-3 small"></div>
          </div>

          <!-- ACCOUNT -->
          <!-- options -->
          <ul class="list-inline list-unstyled mb-0 d-flex align-items-end">

            <!-- account -->
            <li class="list-inline-item mx-1 dropdown">

              <!-- has avatar -->
              <a href="#" id="dropdownAccountOptions"
                class="btn btn-sm btn-icon btn-light dropdown-toggle rounded-circle shadow bg-cover" style=""
                data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false" aria-haspopup="true"
                aria-label="Account options"></a>

              <!-- no avatar -->
              <!--
                <a href="#" id="dropdownAccountOptions" class="btn btn-sm btn-icon btn-light dropdown-toggle rounded-circle" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">
                  <span class="small fw-bold">JD</span>
                </a>
                -->

              <div aria-labelledby="dropdownAccountOptions"
                class="dropdown-menu dropdown-menu-clean dropdown-menu-navbar-autopos dropdown-menu-invert dropdown-fadeindown p-0 mt-2 w-300">

                <!-- user detail -->
                <div class="dropdown-header bg-primary bg-gradient rounded rounded-bottom-0 text-white small p-4">
                  <span class="d-block fw-medium text-truncate">John Doe</span>
                  <span class="d-block smaller fw-medium text-truncate">john.doe@gmail.com</span>
                  <span class="d-block smaller"><b>Last Login:</b> 2019-09-03 01:48</span>
                </div>

                <div class="dropdown-divider mb-3"></div>

                <a href="#" class="dropdown-item text-truncate">
                  <span class="fw-medium">My profile</span>
                  <small class="d-block text-muted smaller">account settings and more</small>
                </a>

                <a href="#" class="dropdown-item text-truncate">
                  <small class="badge bg-success-soft float-end">1 new</small>
                  <span class="fw-medium">My Messages</span>
                  <small class="d-block text-muted smaller">inbox, projects, tasts</small>
                </a>

                <a href="#" class="dropdown-item text-truncate">
                  <small class="badge bg-danger-soft float-end">1 unpaid</small>
                  <span class="fw-medium">My billing</span>
                  <small class="d-block text-muted smaller">your monthly billing</small>
                </a>

                <a href="#" class="dropdown-item text-truncate">
                  <span class="fw-medium">Account Settings</span>
                  <small class="d-block text-muted smaller">profile, password and more...</small>
                </a>



                <div class="dropdown-divider mb-0 mt-3"></div>

                <a href="#" id="logout-btn"
                  class="prefix-icon-ignore dropdown-footer dropdown-custom-ignore fw-medium py-3 px-4">
                  <i class="fi fi-power float-start"></i>
                  Log Out
                </a>
              </div>

            </li>



          </ul>

        </nav>
      </div>
    </header>
    <!-- ================= /HEADER ================= -->


    <!-- content -->
    <div id="wrapper_content" class="d-flex flex-fill">


      <!-- sidebar -->
      <aside id="aside-main" class="aside-start aside-hide-xs bg-white shadow-sm d-flex flex-column px-2 h-auto">


        <!-- sidebar : logo -->
        <div class="py-1 px-1 mb-1 mt-1">
          <a href="admindashboard.html">
            <img src="vista.png" width="160" height="90" alt="VISTA">
          </a>
        </div>
        <!-- /sidebar : logo -->


        <!-- sidebar : navigation -->
        <div class="aside-wrapper scrollable-vertical scrollable-styled-light align-self-baseline h-100 w-100">

          <!--

              All parent open navs are closed on click!
              To ignore this feature, add .js-ignore to .nav-deep
    
              Links height (paddings):
                .nav-deep-xs
                .nav-deep-sm
                .nav-deep-md

              .nav-deep-hover     hover background slightly different
              .nav-deep-bordered  bordered links

            -->
          <nav class="nav-deep nav-deep-sm nav-deep-light">
            <ul id="dynamicMenu" class="nav flex-column">
            </ul>
          </nav>

        </div>
        <!-- /sidebar : navigation -->


        <!-- sidebar : footer -->
        <div class="d-flex align-self-baseline w-100 py-3 px-3 border-top border-light small">

          <p class="d-inline-grid gap-auto-3 mb-0">
            <svg class="text-gray-600" width="22px" height="22px" xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512.052 512.052" fill="currentColor">
              <path
                d="M208.026,16.026c-114.7,0-208,78.9-208,176c0,39.8,15.7,77.9,44.5,108.9l-39.8,39.8c-4.6,4.6-6,11.5-3.5,17.4c2.5,6,8.3,9.9,14.8,9.9h192c114.7,0,208-78.9,208-176S322.726,16.026,208.026,16.026z">
              </path>
              <path opacity="0.5"
                d="M467.526,428.926c28.8-30.9,44.5-69.1,44.5-108.9c0-49.8-24.6-94.9-64-126.9c-0.9,114.1-108.2,206.9-240,206.9h-89.2c34.5,56.9,104.6,96,185.2,96h192c6.5,0,12.3-3.9,14.8-9.9c2.5-6,1.1-12.9-3.5-17.4L467.526,428.926z">
              </path>
              <path fill="#ffffff"
                d="M304.026,144.026h-192c-8.8,0-16,7.2-16,16s7.2,16,16,16h192c8.8,0,16-7.2,16-16S312.826,144.026,304.026,144.026z">
              </path>
              <path fill="#ffffff"
                d="M240.026,208.026h-128c-8.8,0-16,7.2-16,16s7.2,16,16,16h128c8.8,0,16-7.2,16-16S248.826,208.026,240.026,208.026z">
              </path>
            </svg>
            <a href="#" class="link-normal text-dashed">Need help?</a>
          </p>

        </div>
        <!-- /sidebar : footer -->


      </aside>
      <!-- /sidebar -->
      <!-- ================= CONTENT ================= -->


      <div class="modal fade" id="helpModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">

            <div class="modal-header border-0">
              <h5 class="modal-title">Request assistance</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
              <textarea class="form-control" rows="5" placeholder="Describe the issue..."></textarea>
            </div>

            <div class="modal-footer border-0 justify-content-center">
              <button type="button" class="btn btn-primary px-5" id="sendHelpBtn">
                Send
              </button>
            </div>

          </div>
        </div>
      </div>

      <div class="modal fade" id="helpSuccessModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">

            <div class="modal-header border-0">
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body text-center py-5">
              <p class="fs-5 mb-4">
                Your request has been sent.<br>
                Please wait for assistance.
              </p>

              <button type="button" class="btn btn-primary px-5" id="okHelpBtn">
                Ok
              </button>
            </div>

          </div>
        </div>
      </div>

      <!-- main -->
      <main id="middle" class="flex-fill mx-auto">

        <!-- ALERT (UPCOMING ONLY) -->
        <div id="upcomingAlert" class="alert alert-primary d-none">
          Please wait while the administrator
          <a href="#" class="alert-link">initiates</a>
          the service preparation.
        </div>

        <div class="card-header">
          <ul class="nav">
            <li class="nav-item">
              <a class="nav-link active" href="#before" data-phase="before">Before Service</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-secondary" href="#during" data-phase="during">During Service</a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-secondary" href="#after" data-phase="after">After Service</a>
            </li>
          </ul>
        </div>

        <div class="card border-1 border-primary">
          <div class="portlet-body p-4">

            <div class="mb-3 pb-4 pt-1 border-bottom w-100">
              <a class="btn btn-primary btn-soft-static w-100 text-center">
                <strong id="roleID"></strong>
              </a>
            </div>

            <!-- TASKS -->
            <ul id="taskList" class="list-group list-group-flush"></ul>
            <div class="position-relative d-flex justify-content-end">
              <button id="doneBtn" class="btn btn-primary px-5">DONE</button>
            </div>

          </div>


        </div>





      </main>
      <!-- /main -->

    </div>
    <!-- /content -->


    <!-- footer -->
    <footer id="footer" class="bg-white shadow">
      <div class="p-3">

        <span class="small fw-medium">&copy; VISTA App</span>

        <div class="d-inline-block float-end dropdown">
          <ul class="list-inline m-0">

            <!-- LANGUAGE -->
            <li class="dropdown list-inline-item m-0">

              <a id="topDDLanguage" href="#" class="d-inline-block" data-bs-toggle="dropdown" aria-expanded="false"
                aria-haspopup="true">
                <i class="flag flag-us"></i>
                <span class="small px-2">English</span>
              </a>

              <div aria-labelledby="topDDLanguage"
                class="dropdown-menu dropdown-menu-clean shadow-lg small m-0 max-vh-50 scrollable-vertical dropdown-menu-right">
                <a href="#" class="dropdown-item text-primary-hover active">
                  <i class="flag flag-us"></i>
                  English
                </a>

              </div>

            </li>
            <!-- /LANGUAGE -->

          </ul>
        </div>

      </div>
    </footer>
    <!-- /footer -->



  </div><!-- /#wrapper -->


  <!-- Core javascripts -->
  <script src="assets/js/core.min.js"></script>
  <script src="assets/js/vendor_bundle.min.js"></script>


  <!-- modules -->
  <script type="module">
    import "./js/firebase-config.js";
    import "./js/auth.js";
    import "./js/menu.js";
    import "./js/serviceTasks.dynamic.js";
    import "./js/profile_setting.js";

  </script>

  <script type="module">
    import { auth } from "./js/firebase-config.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { db } from "./js/firebase-config.js";  // your existing config
    import { ref, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";


    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "index.html";
      }
    });

    document.getElementById("logout-btn").addEventListener("click", async (e) => {
      e.preventDefault();
      await signOut(auth);
      window.location.href = "index.html";
    });



  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {

      // This function sets up your button events
      function initRequestHelp(requestHelpBtn, sendHelpBtn, okHelpBtn) {
        let helpRequested = false;

        if (sendHelpBtn) {
          sendHelpBtn.addEventListener('click', function () {
            const helpModalEl = document.getElementById('helpModal');
            const successModalEl = document.getElementById('helpSuccessModal');

            bootstrap.Modal.getInstance(helpModalEl).hide();
            new bootstrap.Modal(successModalEl).show();
          });
        }

        if (okHelpBtn) {
          okHelpBtn.addEventListener('click', function () {
            const successModalEl = document.getElementById('helpSuccessModal');
            const successModal = bootstrap.Modal.getInstance(successModalEl);

            // 1️⃣ Hide modal
            successModal.hide();

            // 2️⃣ Cleanup
            document.querySelectorAll('.modal-backdrop').forEach(b => b.remove());
            document.body.classList.remove('modal-open');
            document.body.style.removeProperty('overflow');

            // 3️⃣ Disable button safely
            requestHelpBtn.disabled = true;
            requestHelpBtn.classList.add('disabled');
            requestHelpBtn.removeAttribute('data-bs-toggle');
            requestHelpBtn.removeAttribute('data-bs-target');
            requestHelpBtn.textContent = 'Help Requested';
          });
        }
      }

      // Create a MutationObserver to watch the DOM for your dynamic button
      const observer = new MutationObserver((mutations, obs) => {
        const requestHelpBtn = document.getElementById('request-help-btn');
        const sendHelpBtn = document.getElementById('sendHelpBtn');
        const okHelpBtn = document.getElementById('okHelpBtn');

        if (requestHelpBtn) {
          // Button exists → initialize events
          initRequestHelp(requestHelpBtn, sendHelpBtn, okHelpBtn);

          // Stop observing once initialized
          obs.disconnect();
        }
      });

      // Start observing the body for any new nodes added
      observer.observe(document.body, { childList: true, subtree: true });

    });
  </script>



</body>

</html>